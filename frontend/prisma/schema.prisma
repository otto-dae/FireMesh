// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Modelo para dispositivos ESP32
model Device {
  id          String   @id @default(cuid())
  deviceId    String   @unique // ID único del ESP32 (ej: "esp32_01")
  name        String   // Nombre descriptivo (ej: "Detector Pasillo A")
  location    String   // Descripción de ubicación (ej: "Primer piso, Pasillo A")
  latitude    Float    // Coordenada GPS
  longitude   Float    // Coordenada GPS
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  readings    SensorReading[]
  alerts      Alert[]
  
  @@index([deviceId])
}

// Modelo para lecturas de sensores
model SensorReading {
  id          String   @id @default(cuid())
  deviceId    String
  device      Device   @relation(fields: [deviceId], references: [id], onDelete: Cascade)
  
  temperature Float    // Temperatura en °C
  smoke       Float    // Nivel de humo (ppm o valor del sensor)
  flame       Float    // Nivel de llama (0-1023 o normalizado)
  
  timestamp   DateTime @default(now())
  
  @@index([deviceId, timestamp])
  @@index([timestamp])
}

// Modelo para alertas/estados
model Alert {
  id          String   @id @default(cuid())
  deviceId    String
  device      Device   @relation(fields: [deviceId], references: [id], onDelete: Cascade)
  
  level       AlertLevel // normal, warning, critical
  message     String
  temperature Float?
  smoke       Float?
  flame       Float?
  
  isResolved  Boolean  @default(false)
  createdAt   DateTime @default(now())
  resolvedAt  DateTime?
  
  @@index([deviceId, createdAt])
  @@index([level, isResolved])
}

enum AlertLevel {
  NORMAL
  WARNING
  CRITICAL
}
